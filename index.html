<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Short Generator</title>
<style>
    body {
        margin: 0;
        background: black;
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
    }
    #container {
        width: 400px;
        height: 700px;
        background: #000;
        position: relative;
        overflow: hidden;
        border-radius: 20px;
    }
    video {
        width: 100%;
        height: 60%;
        object-fit: cover;
        position: absolute;
        top: 0;
        opacity: 1;
        transition: opacity 0.4s ease;
    }
    #factDisplay {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 40%;
        background: #000;
        color: #fff;
        text-align: center;
        font-size: 32px;
        font-weight: bold;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        box-sizing: border-box;
        line-height: 1.2;
    }
    #controls {
        position: absolute;
        top: 85%;
        width: 100%;
        display: flex;
        justify-content: space-around;
    }
    button {
        background: red;
        color: white;
        border: none;
        padding: 12px 18px;
        font-size: 18px;
        border-radius: 10px;
        cursor: pointer;
    }
</style>
</head>
<body>

<div id="container">
    <video id="videoA" playsinline></video>
    <video id="videoB" playsinline></video>
    <div id="factDisplay"></div>
    <div id="controls">
        <button id="genBtn">Generate</button>
        <button id="dlBtn">Download</button>
    </div>
</div>

<script src="facts.js"></script>
<script>
const videoSources = [
    "media/slime1.mp4",
    "media/slime2.mp4",
    "media/slime3.mp4",
    "media/slime4.mp4",
    "media/soap1.mp4"
];

const vidA = document.getElementById("videoA");
const vidB = document.getElementById("videoB");
const factDisplay = document.getElementById("factDisplay");
const genBtn = document.getElementById("genBtn");
const dlBtn = document.getElementById("dlBtn");

let currentVid = vidA;
let nextVid = vidB;
let stream;
let recorder;
let recordedChunks = [];
let active = false;

function speak(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.rate = 1.05;
    utter.pitch = 1.0;
    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
}

function getRandom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

function swapVideos() {
    currentVid.style.opacity = 0;
    nextVid.style.opacity = 1;
    [currentVid, nextVid] = [nextVid, currentVid];
}

async function playClip() {
    if (!active) return;
    const fact = getRandom(facts);
    const src = getRandom(videoSources);

    nextVid.src = src;
    factDisplay.textContent = fact;
    speak(fact);

    await nextVid.play();

    swapVideos();

    setTimeout(() => {
        playClip(); // loop every 10s
    }, 10000);
}

function startShort() {
    active = true;
    playClip();
}

genBtn.addEventListener('click', startShort);

// ---- RECORDING / DOWNLOAD ----
dlBtn.addEventListener('click', async () => {
    if (!stream) {
        stream = document.getElementById("container").captureStream(30);
        recorder = new MediaRecorder(stream);

        recorder.ondataavailable = e => recordedChunks.push(e.data);
        recorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: "video/mp4" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "short.mp4";
            a.click();

            recordedChunks = [];
        };

        recorder.start();
        dlBtn.textContent = "Stop + Save";
        speak("Recording started");
    } else {
        recorder.stop();
        stream = null;
        dlBtn.textContent = "Download";
        speak("Recording stopped");
    }
});
</script>

</body>
</html>
