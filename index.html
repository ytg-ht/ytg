<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Short Generator</title>

<style>
    body {
        background:black;
        display:flex;
        flex-direction:column;
        align-items:center;
        font-family:Arial, sans-serif;
    }

    #short-container {
        width:360px;
        height:640px;
        position:relative;
        overflow:hidden;
        background:black;
    }

    video {
        width:100%;
        height:60%;
        object-fit:cover;
        position:absolute;
        top:0;
        left:0;
        opacity:0;
        transition:opacity .6s;
    }

    #captions {
        position:absolute;
        bottom:0;
        width:100%;
        height:40%;
        background:white;
        display:flex;
        justify-content:center;
        align-items:center;
    }

    #captionText {
        width:92%;
        font-size:32px;
        font-weight:bold;
        color:black;
        text-align:center;
        line-height:1.1em;
        padding-bottom:10px;
    }

    button {
        margin-top:14px;
        padding:12px 22px;
        font-size:20px;
        border:none;
        border-radius:12px;
        background:#007aff;
        color:white;
        cursor:pointer;
    }
</style>
</head>

<body>

<!-- VIDEO + CAPTION AREA -->
<div id="short-container">
    <video id="videoA" muted playsinline></video>
    <video id="videoB" muted playsinline></video>
    <div id="captions"><p id="captionText"></p></div>
</div>

<!-- BUTTONS -->
<button id="generate">Generate Short</button>
<button id="downloadBtn" style="display:none;">Download</button>

<script>
/* ðŸ”¹ YOUR FACTS GO HERE â€” must be at least length 7 ðŸ”¹ */
window.facts = [
    "Did you know your nose can remember 50,000 different smells?",
    "Did you know your heart beats around 100,000 times per day?",
    "Did you know a day on Venus is longer than a year on Venus?",
    "Did you know honey never spoils?",
    "Did you know octopuses have three hearts?",
    "Did you know bananas are berries, but strawberries arenâ€™t?",
    "Did you know the Eiffel Tower can be 6 inches taller in summer?"
];

/* ðŸ”¹ You can add more satisfying videos in this folder ðŸ”¹ */
const videos = [
    "videos/1.mp4",
    "videos/2.mp4",
    "videos/3.mp4"
];

const generateBtn = document.getElementById("generate");
const downloadBtn = document.getElementById("downloadBtn");
const vA = document.getElementById("videoA");
const vB = document.getElementById("videoB");

let active = vA;
let buffer = vB;

// Recording
let stream, recorder, chunks = [];
const captions = document.getElementById("captionText");

function splitFact(fact) {
    const words = fact.split(" ");
    const result = [];
    while(words.length) result.push(words.splice(0, 5).join(" "));
    return result;
}

generateBtn.onclick = start;

function start() {
    if(window.facts.length < 7) {
        alert("Add more facts");
        return;
    }

    generateBtn.style.display = "none";
    downloadBtn.style.display = "none";

    const fact = window.facts[Math.floor(Math.random()*window.facts.length)];
    const parts = splitFact(fact);

    // Start TTS only after click (bypass autoplay block)
    let utter = new SpeechSynthesisUtterance(fact);
    speechSynthesis.speak(utter);

    stream = document.getElementById("short-container").captureStream(30);
    startRecording();

    let vidIndex = 0;
    playVideo(vA, videos[vidIndex]);

    let i = 0;
    captions.textContent = parts[i];

    const interval = setInterval(() => {
        i++;
        if(i < parts.length) {
            captions.textContent = parts[i];
        }

        if(i % 2 === 0) {
            vidIndex = (vidIndex + 1) % videos.length;
            fadeVideos(videos[vidIndex]);
        }

        if(i >= parts.length) {
            clearInterval(interval);
            setTimeout(stopRecording, 2000);
        }
    }, 5000);
}

function fadeVideos(nextSrc) {
    buffer.src = nextSrc;
    buffer.play();
    buffer.style.opacity = 1;
    active.style.opacity = 0;
    [active, buffer] = [buffer, active];
}

function playVideo(el, src) {
    el.src = src;
    el.style.opacity = 1;
    el.play();
}

function startRecording() {
    recorder = new MediaRecorder(stream, { mimeType:"video/webm" });
    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = downloadVideo;
    chunks = [];
    recorder.start();
}

function stopRecording() {
    recorder.stop();
}

function downloadVideo() {
    const blob = new Blob(chunks, { type:"video/webm" });
    const url = URL.createObjectURL(blob);
    downloadBtn.style.display = "block";

    downloadBtn.onclick = () => {
        const a = document.createElement("a");
        a.href = url;
        a.download = "short.webm";
        a.click();
    };
}
</script>

</body>
</html>
