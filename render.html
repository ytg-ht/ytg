<!doctype html>
<html>
<body style="background:#111;color:#fff;font-family:Arial;padding:20px">
<h2>Upload voice + music + render</h2>
<textarea id="facts" style="width:100%;height:140px">Paste 7 facts here, each on a new line.</textarea>
<br/>
<label>Voice file (required): <input id="voice" type="file" accept="audio/*"></label>
<label>Music file (optional): <input id="music" type="file" accept="audio/*"></label>
<label>Video file (optional): <input id="video" type="file" accept="video/*"></label>
<button id="render">Render</button>
<p id="status"></p>

<script>
document.getElementById('render').onclick = async () => {
  const status = document.getElementById('status');
  const voice = document.getElementById('voice').files[0];
  if (!voice) return alert('Upload voice file first');
  const music = document.getElementById('music').files[0];
  const video = document.getElementById('video').files[0];

  const factsText = document.getElementById('facts').value.trim().split('\n').map(s => s.trim()).filter(Boolean);
  if (factsText.length === 0) return alert('Paste the 7 facts into the textbox');

  // send captions as array of strings
  const form = new FormData();
  form.append('voice', voice);
  if (music) form.append('music', music);
  if (video) form.append('video', video);
  form.append('captions', JSON.stringify(factsText));
  form.append('width', '1080'); // desired output
  form.append('height', '1920');
  form.append('gap', '0.7');

  status.textContent = 'Uploading & rendering...';

  const resp = await fetch('http://localhost:3001/render', { method: 'POST', body: form });
  if (!resp.ok) {
    const j = await resp.json().catch(()=>null);
    status.textContent = 'Render failed: ' + (j && j.error ? j.error : resp.statusText);
    return;
  }
  const blob = await resp.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'short.mp4';
  a.click();
  status.textContent = 'Download ready';
};
</script>
</body>
</html>
